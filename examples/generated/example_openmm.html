
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Running a simulation in OpenMM &mdash; MDTraj 0.4.1 documentation</title>
    
    <link rel="stylesheet" href="../../_static/nature.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.4.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="top" title="MDTraj 0.4.1 documentation" href="../../index.html" />
    <link rel="up" title="MDTraj Examples" href="../index.html" />
    <link rel="next" title="Using mdtraj and scikits-learn to run principle components analysis." href="example_pca.html" />
    <link rel="prev" title="Clustering with the mdtraj RMSD engine and scipy.cluster.hierarchy." href="example_clustering.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="example_pca.html" title="Using mdtraj and scikits-learn to run principle components analysis."
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="example_clustering.html" title="Clustering with the mdtraj RMSD engine and scipy.cluster.hierarchy."
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">MDTraj 0.4.1 documentation</a> |</li>
          <li><a href="../index.html" accesskey="U">MDTraj Examples</a> |</li>
<a href="../../getting_started.html">Getting Started</a> |
<a href="https://github.com/rmcgibbo/mdtraj/issues">Bugs</a> |
<a href="../index.html">Examples</a> |
<a href="../../mdconvert.html"><span class="pre">mdconvert</span></a>
 

      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="running-a-simulation-in-openmm">
<h1>Running a simulation in OpenMM<a class="headerlink" href="#running-a-simulation-in-openmm" title="Permalink to this headline">Â¶</a></h1>
<p>In this example, we&#8217;e going to actually run a short simulation with OpenMM
saving the results to disk with MDTraj&#8217;s HDF5 reporter</p>
<p>Obviously, running this example calculation on your machine requires
having OpenMM installed. OpenMM can be downloaded and installed from
<a class="reference external" href="https://simtk.org/home/openmm">https://simtk.org/home/openmm</a>.</p>
<p>Lets import some things we&#8217;re going to need from mdtraj</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [1]: </span><span class="kn">import</span> <span class="nn">mdtraj</span>

<span class="gp">In [2]: </span><span class="kn">import</span> <span class="nn">mdtraj.reporters</span>
</pre></div>
</div>
<p>And a few things froms OpenMM</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [3]: </span><span class="kn">from</span> <span class="nn">simtk</span> <span class="kn">import</span> <span class="n">unit</span>

<span class="gp">In [4]: </span><span class="kn">import</span> <span class="nn">simtk.openmm</span> <span class="kn">as</span> <span class="nn">mm</span>

<span class="gp">In [5]: </span><span class="kn">from</span> <span class="nn">simtk.openmm</span> <span class="kn">import</span> <span class="n">app</span>
</pre></div>
</div>
<p>First, lets find a PDB for alanine dipeptide, the system we&#8217;ll
be simulating. We happen to have one inlcuded in the mdtraj
package for testing named &#8220;native.pdb&#8221;. Under normal circumstances
circumstances, you shouldn&#8217;t have much need for mdtraj.testing.get_fn
(unless you&#8217;re contributing tests to mdtraj!)</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [6]: </span><span class="kn">import</span> <span class="nn">mdtraj.testing</span>

<span class="gp">In [7]: </span><span class="n">pdb</span> <span class="o">=</span> <span class="n">mdtraj</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">get_fn</span><span class="p">(</span><span class="s">&#39;native.pdb&#39;</span><span class="p">))</span>

<span class="gp">In [8]: </span><span class="n">topology</span> <span class="o">=</span> <span class="n">pdb</span><span class="o">.</span><span class="n">topology</span><span class="o">.</span><span class="n">to_openmm</span><span class="p">()</span>
</pre></div>
</div>
<p>Lets use the amber99sb-ildn forcefield with implicit solvent
and a langevin integrator. This is relatively &#8220;standard&#8221; OpenMM
code for setting up a system.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [9]: </span><span class="n">forcefield</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">ForceField</span><span class="p">(</span><span class="s">&#39;amber99sbildn.xml&#39;</span><span class="p">,</span> <span class="s">&#39;amber99_obc.xml&#39;</span><span class="p">)</span>

<span class="gp">In [10]: </span><span class="n">system</span> <span class="o">=</span> <span class="n">forcefield</span><span class="o">.</span><span class="n">createSystem</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">nonbondedMethod</span><span class="o">=</span><span class="n">app</span><span class="o">.</span><span class="n">CutoffNonPeriodic</span><span class="p">)</span>

<span class="gp">In [11]: </span><span class="n">integrator</span> <span class="o">=</span> <span class="n">mm</span><span class="o">.</span><span class="n">LangevinIntegrator</span><span class="p">(</span><span class="mi">330</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span><span class="p">,</span> <span class="mf">1.0</span><span class="o">/</span><span class="n">unit</span><span class="o">.</span><span class="n">picoseconds</span><span class="p">,</span> <span class="mf">2.0</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">femtoseconds</span><span class="p">)</span>

<span class="gp">In [12]: </span><span class="n">simulation</span> <span class="o">=</span> <span class="n">app</span><span class="o">.</span><span class="n">Simulation</span><span class="p">(</span><span class="n">topology</span><span class="p">,</span> <span class="n">system</span><span class="p">,</span> <span class="n">integrator</span><span class="p">)</span>
</pre></div>
</div>
<p>Set the initial positions to the &#8220;first frame&#8221; of the PDB
file (it only has one frame). Note that pdb is an mdtraj trajectory
pass in its positions to OpenMM just fine though.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [13]: </span><span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setPositions</span><span class="p">(</span><span class="n">pdb</span><span class="o">.</span><span class="n">xyz</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="gp">In [14]: </span><span class="n">simulation</span><span class="o">.</span><span class="n">context</span><span class="o">.</span><span class="n">setVelocitiesToTemperature</span><span class="p">(</span><span class="mi">330</span><span class="o">*</span><span class="n">unit</span><span class="o">.</span><span class="n">kelvin</span><span class="p">)</span>
</pre></div>
</div>
<p>Let&#8217;s use one of the OpenMM reporters that mdtraj provides. This is
the hdf5 reporter, which saves all kinds of information, including
the topology, positions, energies, etc to disk. To visualize the h5
trajectory with a non-hdf5 enabled app like PyMol or VMD, you can
use mdconvert on the command line to easily transform it to NetCDF, DCD,
or any other format of your preference.</p>
<div class="highlight-ipython"><div class="highlight"><pre><span class="gp">In [15]: </span><span class="n">simulation</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">mdtraj</span><span class="o">.</span><span class="n">reporters</span><span class="o">.</span><span class="n">HDF5Reporter</span><span class="p">(</span><span class="s">&#39;ala2.h5&#39;</span><span class="p">,</span> <span class="mi">1000</span><span class="p">))</span>

<span class="gp">In [16]: </span><span class="n">simulation</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">100000</span><span class="p">)</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<a href="../../index.html"><img src="../../_static/mdtraj_logo-small.png" alt="Logo"/></a>

  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/examples/generated/example_openmm.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../np-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="example_pca.html" title="Using mdtraj and scikits-learn to run principle components analysis."
             >next</a> |</li>
        <li class="right" >
          <a href="example_clustering.html" title="Clustering with the mdtraj RMSD engine and scipy.cluster.hierarchy."
             >previous</a> |</li>
        <li><a href="../../index.html">MDTraj 0.4.1 documentation</a> |</li>
          <li><a href="../index.html" >MDTraj Examples</a> |</li>
<a href="../../getting_started.html">Getting Started</a> |
<a href="https://github.com/rmcgibbo/mdtraj/issues">Bugs</a> |
<a href="../index.html">Examples</a> |
<a href="../../mdconvert.html"><span class="pre">mdconvert</span></a>
 

      </ul>
    </div>

    <div class="footer">
        &copy; Copyright 2013, Robert McGibbon and contributors.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-42143125-1', 'rmcgibbo.github.io');
  ga('send', 'pageview');
</script>

  </body>
</html>